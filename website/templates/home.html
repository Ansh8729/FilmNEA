{% extends "base.html" %}
{% block title %}Login{% endblock %}
{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <title>Home</title>
    <style>
        body { background-color: #eff1f3; font-family:futura; font-weight: bold;}
        /* CSS styles for the card */
        .card {
            width: 500px;
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background-color: #fff;
            text-align: left; /* Align text to the left */
            display: flex;
            flex-direction: column;
        }
        .profile-pic {
            width: 15%;
            height: 15%;
            margin-bottom: 50px
        }
        .user-info {
            display: flex;
            align-items: center;
        }
        .username {
            font-weight: bold;
            text-align: left; /* Align text to the left */
            margin-left: 15px; /* Add some spacing between the profile pic and username */
            margin-bottom: 50px;
        }
        .logline {
            margin-top: 10px;
            text-align: center; /* Align text to the left */
        }
        .message {
            margin-top: 20px;
            text-align: center; /* Align text to the left */
        }
        .genres {
            margin-top: 10px;
            text-align: left; /* Align text to the left */
        }
        .ratings {
            margin-top: 10px;
            text-align: left; /* Align text to the left */
            display: flex;
            align-items: center;
        }
        .star {
            color: orange;
            font-size: 20px;
            cursor: pointer;
        }
        .average-rating {
            margin-left: 10px;
        }
        .delete-button {
            margin-top: 10px;
            text-align: center; /* Align text to the center */
        }
        .pdf-embed {
            width: 100%;
            height: 400px; /* Adjust the height as needed */
        }
    </style>
</head>
<body>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    {% if featured %}
        <div style="text-align: center">
            <h2>Featured Screenplay of the Day #{{script.featuredid}}</h2>
            {% if script != None %}
                <h2>{{script.script.title}}</h2>
                {{script.script.logline}}
                <p>By: {{script.script.writer.user.username}}</p>
                <embed style="text-align: center;" src="{{url_for('static', filename='images/'+ script.script.screenplay)}}#toolbar=0" width = "75%" height = "550px%">
            {% else %}
                <h3>No featured scripts at the moment</h3>
            {% endif %}
        </div>
    {% endif %}
    <br><br>
    <div class="row">
        <div style="text-align:center" class="col-3">
            <br><br>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="height:50%; width:50%">
                  Genre List
                </button>
                <ul class="dropdown-menu">
                    <form action="/filter" method="POST" style="text-align:center">
                        <li><button name="genre" value="0" class="btn btn-dark">All</button></li><br>
                        <li><button name="genre" value="1" class="btn btn-dark">Action</button></li><br>
                        <li><button name="genre" value="2" class="btn btn-dark">Adventure</button></li><br>
                        <li><button name="genre" value="3" class="btn btn-dark">Comedy</button></li><br>
                        <li><button name="genre" value="4" class="btn btn-dark">Drama</button></li><br>
                        <li><button name="genre" value="5" class="btn btn-dark">Fantasy</button></li><br>
                        <li><button name="genre" value="6" class="btn btn-dark">Horror</button></li><br>
                        <li><button name="genre" value="7" class="btn btn-dark">Musical</button></li><br>
                        <li><button name="genre" value="8" class="btn btn-dark">Mystery</button></li><br>
                        <li><button name="genre" value="9" class="btn btn-dark">Romance</button></li><br>
                        <li><button name="genre" value="10" class="btn btn-dark">Sci-Fi</button></li><br>
                        <li><button name="genre" value="11" class="btn btn-dark">Sports</button></li><br>
                        <li><button name="genre" value="12" class="btn btn-dark">Thriller</button></li><br>
                        <li><button name="genre" value="13" class="btn btn-dark">Western</button></li><br>
                    </form>
                </ul>
            </div>
        </div>
        <div class="col-6" style="text-align:center">
            <form method='POST' action="/sort">
                <input type="radio" name="sorted" id="default" value="0"></input>
                <label for="default">Default</label>
                <input type="radio" name="sorted" id="new" value="1"></input>
                <label for="new">New</label>
                <input type="radio" name="sorted" id="week" value="2"></input>
                <label for="week">Top of Week</label>
                <input type="radio" name="sorted" id="month" value="3"></input>
                <label for="month">Top of Month</label>
                <input type="submit" value="Submit">
            </form>
            <br>
            <div id="posts">
            {% if posts %}
                {% for post in posts %}
                <div class="card">
                    <div class="user-info">
                        {% if post.writer.user.profilepic %}
                            <img src="{{ url_for('static', filename='images/'+ post.writer.user.profilepic) }}" width = "110px" height = "110px" alt="Profile picture" class="profile-pic">
                        {% else %}
                            <img src="/static/images/default.jpg" alt="Default profile picture" width = "110px" height = "110px" class="profile-pic">
                        {% endif %}
                        <a href="/profilepage/{{post.writer.user.id}}" class="username"><h4>{{post.writer.user.username}}</h4></a>
                    </div>
                    <!--
                    {% if user.accounttype == 1 %}
                            {% if post.writer.user.id != user.id %}
                                <div style="text-align:right">
                                        <form class="star-rating" method = "POST" action="/rate/{{post.scriptid}}">
                                            <input class="radio-input" type="radio" id="star5" name="star-input" value="5" />
                                            <label class="radio-label" class for="star5" title="5 stars">5 stars</label>
                                            <input class="radio-input" type="radio" id="star4" name="star-input" value="4" />
                                            <label class="radio-label" for="star4" title="4 stars">4 stars</label>
                                            <input class="radio-input" type="radio" id="star3" name="star-input" value="3" />
                                            <label class="radio-label" for="star3" title="3 stars">3 stars</label>
                                            <input class="radio-input" type="radio" id="star2" name="star-input" value="2" />
                                            <label class="radio-label" for="star2" title="2 stars">2 stars</label>
                                            <input class="radio-input" type="radio" id="star1" name="star-input" value="1" />
                                            <label class="radio-label" for="star1" title="1 star">1 star</label>
                                            <br>
                                            <input type="submit" value="Submit Rating" onclick="return confirm('Are you sure you want to give the screenplay this rating? You will not be able to change your rating.')">
                                        </form>
                                        {% for like in likes %}
                                            {% if (like.writer.user.id == user.id) and (like.script.scriptid == post.scriptid) %}
                                                <p>You rated it: {{like.rating}}/5</p>
                                            {% endif %}
                                        {% endfor %}
                                </div>
                            {% endif %}
                    {% endif %}-->
                    {% if post.avgrating %}
                        <span class="average-rating">Average Rating: {{post.avgrating}}</span>
                        <br>
                    {% endif %}
                    {% if user.id == post.writer.user.id %}
                        <form action = /delete-post/{{post.scriptid}} method="POST">
                            <input class="delete-button" type="submit" value="Delete" onclick="return confirm('Are you sure you want to delete this post?')">
                        </form>
                    {% endif %}
                    {% if post.screenplay %}
                        <a style="text-align: center" href="/script/{{post.scriptid}}" target="_blank"><h2>{{post.title}}</h2></a>
                    {% else %}
                        <div style="text-align: center"><h2>{{post.title}}</h2></div>
                    {% endif %}
                    <div class="genres">
                        <h4>Genres:</h4>
                        {% for script in scripthas %}
                                {% if script.scriptid == post.scriptid %}
                                    <b>{{script.has.genre}}</b><br>
                                {% endif %}
                        {% endfor %}
                    </div>
                    <p class="logline">Logline: {{post.logline}}</p>
                    <p class="message">{{post.message}}</p>
                    {% if post.screenplay %}
                        <embed class="pdf-embed" style="text-align: center;" src="{{url_for('static', filename='images/'+ post.screenplay)}}#toolbar=0" width = "100%" height = "550px%"> 
                    {% else %}
                        <h2>Screenplay not available</h2>
                    {% endif %}
                    <br>
                    {% if user.accounttype == 1 %}
                        <div class="card border-dark">
                            <div class="card-body">
                            <h3>Comments</h3>
                            {% for comment in comments %}
                                {% if comment.scriptid == post.scriptid %}
                                    <div style="text-align:left">
                                        <b><a href="/profilepage/{{comment.writer.user.id}}">{{comment.writer.user.username}}</a></b>:
                                        {% if comment.writer.user.id == user.id %}
                                            {{comment.comment}}
                                            <form method="POST" action="/delete-comment/{{ comment.commentid }}"><button type="submit" name="Delete">Delete</button></form>
                                        {% else %}
                                            {{comment.comment}}
                                        {% endif %}
                                    </div>
                                {% endif %}
                            {% endfor %}
                            </div>
                            <br>
                            <form class="input-group mb-3"method="POST" action="/create-comment/{{post.scriptid}}">
                                <input type="text" id="text" name="text" class="form-control" placeholder="Comment something!"/>
                                <button type="submit" class="btn btn-primary">Comment</button>
                            </form>
                        </div>
                        {% else %}
                        <div class="text-align:left">
                            <form method="POST" name="response" action="/response/{{post.scriptid}}">
                                <input type="text" name="response" id="response" class="form-control">
                                <label for="response">Send Response</label>
                                <input type="submit">
                            </form>
                        </div>
                        <div class="text-align:right">
                            <form method="POST" action="/response/{{post.scriptid}}" name="request">
                                <label for="request">Request Full Access</label>
                                <input name="request" type="submit" onclick="return confirm('Are you sure you want to request for this screenplay?')">
                            </form>
                        </div>
                        {% endif %}
                </div>
                        
                <br>
                    {% endfor %}
            {% else %}
            <h1>No posts available</h1>
            {% endif %}
            </div>
        </div>
        {% if user.accounttype == 1 %}
            <div class="col-3" style="text-align:center">
                <br>
                <br>
                <h2>Recommended Screenplays</h2>
                {% if recs == None %}
                <div style="text-align:center">
                    <h4>No recommendations available</h4>
                </div>
                {% else %}
                    {% for i in recs %}
                        {% if i.screenplay %}
                        <a href="/script/{{i.scriptid}}" target="_blank"><h3>{{ i.title }}</h3></a>
                        {% else %}
                        <h3>{{i.title}}</h3>
                        {% endif %}
                        <h4>Rating: {{ i.avgrating }}/5</h4>  
                    {% endfor %}
                {% endif %}
            </div>
        {% endif %}
    </div>
</body>
</html>
{% endblock %}